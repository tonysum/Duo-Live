# AE Server â†’ duo-live ç‰¹æ€§ç§»æ¤æ€»ç»“

## ç§»æ¤å®Œæˆæ—¶é—´
2024-02-28

## ç§»æ¤çš„4é¡¹ç‰¹æ€§

### 1. âœ… è¿ç»­æš´æ¶¨ä¿æŠ¤é€»è¾‘
**æ–‡ä»¶**: `live/strategy.py`

**æ”¹åŠ¨**:
- åœ¨ `SurgeShortStrategy.evaluate_position()` æ–¹æ³•çš„12å°æ—¶åˆ¤æ–­ä¸­å¢åŠ è¿ç»­æš´æ¶¨æ£€æŸ¥
- æ–°å¢ `_check_consecutive_surge()` é™æ€æ–¹æ³•

**é€»è¾‘**:
```python
# 12å°æ—¶åˆ¤æ–­æ—¶
if ä¸‹è·Œå æ¯” < 60%:
    if è¿ç»­2å°æ—¶å–é‡æš´æ¶¨:
        ä¿æŒå¼ºåŠ¿/ä¸­ç­‰å¸æ­¢ç›ˆ  # ä¸é™ä¸ºå¼±åŠ¿å¸
    else:
        é™ä¸ºå¼±åŠ¿å¸æ­¢ç›ˆ
```

**å½±å“**:
- å¯¹è¿ç»­æš´æ¶¨ä¿¡å·æ›´å‹å¥½ï¼Œé¿å…è¿‡æ—©æ­¢ç›ˆ
- æé«˜ç›ˆåˆ©æ½œåŠ›

---

### 2. âœ… å¹³ä»“å‰ä¸¥æ ¼æ£€æŸ¥æœºåˆ¶
**æ–‡ä»¶**: `live/live_position_monitor.py`

**æ”¹åŠ¨**:
- é‡å†™ `_force_close()` æ–¹æ³•ï¼Œå¢åŠ 6ä¸ªæ­¥éª¤ï¼š
  1. å¹³ä»“å‰å–æ¶ˆæ‰€æœ‰æœªæˆäº¤è®¢å•
  2. ä»äº¤æ˜“æ‰€è·å–å®é™…æŒä»“æ•°é‡å’Œæ–¹å‘
  3. åŠ¨æ€è·å–æ•°é‡ç²¾åº¦å¹¶è°ƒæ•´
  4. æ ¹æ®å®é™…ä»“ä½æ–¹å‘å†³å®šå¹³ä»“æ–¹å‘
  5. å…ˆå°è¯• reduceOnlyï¼Œå¤±è´¥åˆ™é‡è¯•æ™®é€šå¸‚ä»·å•
  6. æ”¯æŒåˆ†æ‰¹å¹³ä»“ï¼ˆè§ä¸‹ä¸€é¡¹ï¼‰

**å½±å“**:
- å¤§å¹…æé«˜å¹³ä»“æˆåŠŸç‡
- é¿å…å› ç¨‹åºè®°å½•ä¸å‡†ç¡®å¯¼è‡´çš„å¹³ä»“å¤±è´¥
- å‡å°‘å› ç²¾åº¦é—®é¢˜å¯¼è‡´çš„ API é”™è¯¯

---

### 3. âœ… åˆ†æ‰¹å¹³ä»“å®¹é”™æœºåˆ¶
**æ–‡ä»¶**: `live/live_position_monitor.py`

**æ”¹åŠ¨**:
- åœ¨ `_force_close()` æ–¹æ³•ä¸­æ•è· "Margin is insufficient" é”™è¯¯
- è‡ªåŠ¨åˆ†æ‰¹å¹³ä»“ï¼šå…ˆå¹³ä¸€åŠ â†’ ç­‰å¾… â†’ é‡æ–°è·å–å‰©ä½™æŒä»“ â†’ å¹³ä»“å‰©ä½™

**å½±å“**:
- æé«˜æç«¯æƒ…å†µä¸‹çš„å¹³ä»“æˆåŠŸç‡
- é¿å…å› ä¿è¯é‡‘ä¸è¶³å¯¼è‡´çš„æŒä»“å¡æ­»

---

### 4. âœ… é‚®ä»¶æŠ¥è­¦ç³»ç»Ÿ
**æ–‡ä»¶**: `live/notifier.py`

**æ”¹åŠ¨**:
- æ–°å¢ `send_email_alert()` æ–¹æ³• - å‘é€æ™®é€šé‚®ä»¶æŠ¥è­¦
- æ–°å¢ `send_critical_alert()` æ–¹æ³• - å‘é€ç´§æ€¥æŠ¥è­¦ï¼ˆTelegram + é‚®ä»¶ï¼‰
- åœ¨ `__init__()` ä¸­å¢åŠ é‚®ä»¶é…ç½®å‚æ•°

**é…ç½®**:
```bash
SMTP_EMAIL=your_email@163.com
SMTP_PASSWORD=your_authorization_code
ALERT_EMAIL=alert_receiver@example.com
```

**ä½¿ç”¨åœºæ™¯**:
- å¹³ä»“å¤±è´¥ï¼ˆå®Œå…¨å¤±è´¥æˆ–åˆ†æ‰¹å¤±è´¥ï¼‰
- ä¿è¯é‡‘ä¸è¶³
- ç³»ç»Ÿå¼‚å¸¸

**å½±å“**:
- æé«˜ç´§æ€¥æƒ…å†µçš„é€šçŸ¥å¯é æ€§
- æ”¯æŒå¤šæ¸ é“æŠ¥è­¦ï¼Œé™ä½æ¼æŠ¥é£é™©

---

## æ–°å¢æ–‡ä»¶

1. **docs/improvements-from-ae-server.md** - è¯¦ç»†æ”¹è¿›æ–‡æ¡£
2. **tests/test_email_alert.py** - é‚®ä»¶åŠŸèƒ½æµ‹è¯•è„šæœ¬
3. **.env.example** - ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹ï¼ˆåŒ…å«é‚®ä»¶é…ç½®ï¼‰
4. **MIGRATION_SUMMARY.md** - æœ¬æ–‡ä»¶

---

## ä¿®æ”¹çš„æ–‡ä»¶

1. **live/strategy.py**
   - æ–°å¢ `_check_consecutive_surge()` æ–¹æ³•
   - ä¿®æ”¹ `evaluate_position()` æ–¹æ³•çš„12å°æ—¶åˆ¤æ–­é€»è¾‘

2. **live/live_position_monitor.py**
   - é‡å†™ `_force_close()` æ–¹æ³•ï¼ˆå¢åŠ 6ä¸ªæ­¥éª¤ï¼‰
   - æ›´æ–°ç´§æ€¥é€šçŸ¥è°ƒç”¨ä¸º `send_critical_alert()`

3. **live/notifier.py**
   - æ–°å¢é‚®ä»¶é…ç½®å‚æ•°
   - æ–°å¢ `send_email_alert()` æ–¹æ³•
   - æ–°å¢ `send_email_alert_sync()` æ–¹æ³•
   - æ–°å¢ `send_critical_alert()` æ–¹æ³•

4. **README.md**
   - åœ¨é¡¶éƒ¨æ·»åŠ "æœ€æ–°æ”¹è¿›"ç« èŠ‚
   - åœ¨"ç¯å¢ƒå˜é‡"ç« èŠ‚æ·»åŠ é‚®ä»¶é…ç½®è¯´æ˜

---

## æµ‹è¯•å»ºè®®

### 1. è¿ç»­æš´æ¶¨ä¿æŠ¤æµ‹è¯•
```bash
# éœ€è¦ç­‰å¾…å®é™…ä¿¡å·è§¦å‘ï¼Œæˆ–ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
# è§‚å¯Ÿ12å°æ—¶åˆ¤æ–­æ—¶çš„æ—¥å¿—è¾“å‡º
```

### 2. å¹³ä»“æœºåˆ¶æµ‹è¯•
```bash
# æ‰‹åŠ¨å–æ¶ˆæ­¢ç›ˆæ­¢æŸè®¢å•ï¼Œè§‚å¯Ÿå¹³ä»“å‰æ˜¯å¦æ­£ç¡®å–æ¶ˆ
# ä¿®æ”¹ç¨‹åºè®°å½•çš„æŒä»“æ•°é‡ï¼Œè§‚å¯Ÿæ˜¯å¦ä½¿ç”¨äº¤æ˜“æ‰€å®é™…æ•°é‡
```

### 3. é‚®ä»¶æŠ¥è­¦æµ‹è¯•
```bash
python tests/test_email_alert.py
```

---

## å…¼å®¹æ€§è¯´æ˜

- âœ… æ‰€æœ‰æ”¹åŠ¨å‘åå…¼å®¹
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… é‚®ä»¶åŠŸèƒ½ä¸ºå¯é€‰é…ç½®ï¼Œä¸é…ç½®ä¸å½±å“ç³»ç»Ÿè¿è¡Œ
- âœ… è¿ç»­æš´æ¶¨ä¿æŠ¤ä»…åœ¨12å°æ—¶åˆ¤æ–­æ—¶ç”Ÿæ•ˆï¼Œä¸å½±å“2å°æ—¶åˆ¤æ–­

---

## åç»­ä¼˜åŒ–å»ºè®®

1. **è¿ç»­æš´æ¶¨åˆ¤æ–­ä¼˜åŒ–**
   - å½“å‰ä½¿ç”¨å»ºä»“æ—¶é—´å¾€å‰æ¨1å°æ—¶ä¼°ç®—ä¿¡å·æ—¶é—´
   - å»ºè®®åœ¨ `TrackedPosition` ä¸­å¢åŠ  `signal_time` å­—æ®µï¼Œè®°å½•çœŸå®ä¿¡å·æ—¶é—´

2. **é‚®ä»¶æŠ¥è­¦å¢å¼º**
   - æ”¯æŒæ¯æ—¥äº¤æ˜“æŠ¥å‘Šé‚®ä»¶
   - æ”¯æŒè‡ªå®šä¹‰é‚®ä»¶æ¨¡æ¿
   - æ”¯æŒæ›´å¤šé‚®ä»¶æœåŠ¡å•†ï¼ˆGmailã€Outlookç­‰ï¼‰

3. **åˆ†æ‰¹å¹³ä»“ä¼˜åŒ–**
   - æ”¯æŒæ›´çµæ´»çš„åˆ†æ‰¹ç­–ç•¥ï¼ˆå¦‚åˆ†3æ‰¹ã€åˆ†5æ‰¹ï¼‰
   - è®°å½•åˆ†æ‰¹å¹³ä»“è¯¦æƒ…åˆ°æ•°æ®åº“

4. **ç›‘æ§å¢å¼º**
   - åœ¨ Web Dashboard ä¸­æ˜¾ç¤ºé‚®ä»¶å‘é€çŠ¶æ€
   - å¢åŠ é‚®ä»¶å‘é€å†å²è®°å½•

---

## å‚è€ƒèµ„æ–™

- [AE Server Script æºç ](live/AE Server Script.py)
- [æ”¹è¿›è¯¦ç»†æ–‡æ¡£](docs/improvements-from-ae-server.md)
- [duo-live åŸå§‹æ¶æ„](README.md)

---

## ç‰ˆæœ¬ä¿¡æ¯

- **duo-live ç‰ˆæœ¬**: v2.0
- **ç§»æ¤æ¥æº**: AE Server Script v2.0
- **ç§»æ¤æ—¥æœŸ**: 2024-02-28
- **ç§»æ¤äººå‘˜**: Kiro AI Assistant

---

## ç¡®è®¤æ¸…å•

- [x] è¿ç»­æš´æ¶¨ä¿æŠ¤é€»è¾‘å·²å®ç°
- [x] å¹³ä»“å‰ä¸¥æ ¼æ£€æŸ¥æœºåˆ¶å·²å®ç°
- [x] åˆ†æ‰¹å¹³ä»“å®¹é”™æœºåˆ¶å·²å®ç°
- [x] é‚®ä»¶æŠ¥è­¦ç³»ç»Ÿå·²å®ç°
- [x] æ–‡æ¡£å·²æ›´æ–°
- [x] æµ‹è¯•è„šæœ¬å·²åˆ›å»º
- [x] é…ç½®ç¤ºä¾‹å·²æ›´æ–°
- [x] README å·²æ›´æ–°
- [ ] å®é™…ç¯å¢ƒæµ‹è¯•ï¼ˆå¾…ç”¨æˆ·æ‰§è¡Œï¼‰
- [ ] é‚®ä»¶åŠŸèƒ½æµ‹è¯•ï¼ˆå¾…ç”¨æˆ·æ‰§è¡Œï¼‰

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼åé¦ˆï¼š
- GitHub Issues
- Pull Requests
- é¡¹ç›®ç»´æŠ¤è€…é‚®ç®±

---

**ç§»æ¤å®Œæˆï¼** ğŸ‰
