# 设计文档 - AE Server 迁移与网络优化

## 简介

本文档描述了从 AE Server Script 迁移到 duo-live 系统的核心交易逻辑改进和网络稳定性优化的详细设计。该功能包含两大类改进：

1. **四项核心交易逻辑改进**：连续暴涨保护、平仓检查机制、分批平仓容错、邮件报警
2. **三项网络稳定性优化**：重试机制、超时配置、监控频率

这些改进旨在提高交易系统的盈利能力、平仓成功率、系统稳定性和报警可靠性。

---

## 概览

### 系统架构

duo-live 是一个基于 Python 的加密货币期货自动交易系统，采用模块化架构：

```
┌─────────────────────────────────────────────────────────────┐
│                      Live Trading System                     │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────────┐      ┌──────────────┐                     │
│  │   Scanner    │─────▶│   Strategy   │                     │
│  │ (信号扫描)    │      │  (策略引擎)   │                     │
│  └──────────────┘      └──────┬───────┘                     │
│                               │                              │
│                               ▼                              │
│  ┌──────────────┐      ┌──────────────┐                     │
│  │   Executor   │◀─────│   Monitor    │                     │
│  │ (订单执行)    │      │ (持仓监控)    │                     │
│  └──────┬───────┘      └──────┬───────┘                     │
│         │                     │                              │
│         ▼                     ▼                              │
│  ┌──────────────────────────────────┐                       │
│  │      Binance Client              │                       │
│  │  (API客户端 + 网络优化)           │                       │
│  └──────────────┬───────────────────┘                       │
│                 │                                            │
│                 ▼                                            │
│  ┌──────────────────────────────────┐                       │
│  │         Notifier                 │                       │
│  │  (Telegram + Email 报警)          │                       │
│  └──────────────────────────────────┘                       │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 核心组件

1. **Strategy Engine (策略引擎)**: 负责信号评估和动态止盈调整，包含连续暴涨保护逻辑
2. **Position Monitor (持仓监控)**: 负责持仓监控和平仓执行，包含增强的平仓机制
3. **Binance Client (API客户端)**: 负责与币安交易所通信，包含网络优化
4. **Notifier (通知系统)**: 负责发送报警通知，包含邮件报警功能
5. **Config (配置管理)**: 负责系统配置管理，包含监控频率等参数

---

## 架构设计

### 1. 连续暴涨保护逻辑

#### 设计目标
在12小时动态止盈评估时，识别连续暴涨信号并保持较高的止盈目标，避免过早止盈。

#### 架构组件
- **位置**: `live/strategy.py` - `SurgeShortStrategy` 类
- **触发时机**: 持仓达到12小时且下跌占比 < 60%
- **依赖**: Binance Client (获取历史K线数据)

